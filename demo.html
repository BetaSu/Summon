<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>demo</title>
<style>
* {margin: 0;padding: 0;}  
body,html {height: 100%;}
.parent {background: #00f;height:100%;width: 40%;margin: 0 auto;position: relative;}
.f-item {background: #ff0;position: absolute;text-align: center;font: 30px "ariel";}
.f-item:hover {background: #0f0;border-radius: 12px;}
.f-click {background: #ccc;}
.targetNum {margin: 0 50px; font-size: 40px;}
</style>
</head>
<body>

<div class="parent"></div>
<h3 class="targetNum"></h3>
</body>
<script src="script/jquery_min.js"></script>

<script>


	$(function  () {

		// a-b间的随机数，接收2个参数
		//a代表起始参数
		//b代表结束参数
		function ranatb (a,b) {
			var result=Math.floor(a+Math.random()*(b-a+1));
			return result;
		}

		
		var $box=$('.parent'),
		w=parseFloat($box.css('width'));
		$box.css('height',w+'px');
		var itemW=w/7,						//表格宽度
		itemIndex=0,						//表格索引
		itemTop=0,							//距父级顶部距离
		numArr=[],							//选中的数字
		targetNum;							//目标数字

		// 动态生成表格
		for (var j=0;j<w;j+=itemW) {
			for (var i=0;i<w;i+=itemW) {
				var num=ranatb(1,9);
				$box.append("<div class='f-item'></div>");
				var $item=$('div[class=f-item]:last');
				$item.css({left:i+'px',top:itemTop+'px',width:itemW+'px',height:itemW+'px'}).html(num).data({'num':num,'index':itemIndex++});
			}
			itemTop+=itemW;
		}

		

		// 产生一个目标数字
		function CreTargetNum () {
			var $items=$('div.f-item'),
			totalIndex=$items.last().index(),
			$items=$('div.f-item'),
			result=0;
			//产生一个目标索引,接收一个参数
			//arr：该数组中包含的数不会作为函数的返回值
			function targetIndex (arr) {
				var result=ranatb(0,4);
				if ($.type(arr)=='array' &&arr.length!=0) {
					var trigger=false;
					$.each(arr,function  (index,item) {
						if (item==result) {
							trigger=!trigger;
						}	
					})
					if (trigger) return targetIndex(arr);
				} 
				return result;
			}

			if (totalIndex>=2) {
			var result1=targetIndex(),
			result2=targetIndex([result1]),
			result3=targetIndex([result1,result2]),
			num1=$items.eq(result1).data('num'),
			num2=$items.eq(result2).data('num'),
			num3=$items.eq(result3).data('num');
			result=num1+num2+num3;
			} if (totalIndex>=0&&totalIndex<2) {
				$('div.f-item').each(function  (index,item) {
					result+=$(item).data('num');
				})
			} else {
				$('h3.targetNum').html('congratulation!');
			}
			$('h3.targetNum').html(result);
			targetNum=result;
			console.log(totalIndex);
			return result;	
		}

		//判断数字是否相符
		function judge () {
			var totalNum=0;

			//匹配成功后消除方块
			function success () {
				$('div.f-click').remove();
			}

			// 判断是否超过目标值
			$.each(numArr,function  (index,item) {
				totalNum+=item;
			})

			//结果处理
			if (totalNum>targetNum) {
				numArr=[];
				$('div.f-item').removeClass('f-click');
			}
			if (totalNum==targetNum) {
				success();
				numArr=[];
				CreTargetNum();	
			}
			
		}
		
		$('div.f-item').click(function  () {
			if (!$(this).hasClass('f-click')) {
				$(this).addClass('f-click');
				var num=$(this).data('num');
				numArr.push(num);
				judge();
			}
		})

		CreTargetNum()
	})
</script>


</html>